schemaVersion: "2.0.0"
commandTests:
  - name: "Candle Ingestor Dry Run Test (Single Execution)"
    command: "/services/candle_ingestor/app"
    args: [
        "--run_mode=dry",
        "--tiingo_api_key=dummykey",
        "--influxdb_token=dummytoken", # Required by flag definition even if not used in dry
        "--influxdb_org=dummyorg", # Required by flag definition
        "--top_n_cryptos=1", # Limit for faster test
        "--backfill_start_date=1_day_ago", # Short backfill
        "--candle_granularity_minutes=60",
        "--catch_up_initial_days=1", # Short catchup if no state
      ]
    # Expected to exit cleanly after a single run in dry mode.
    # Check for specific log messages indicating dry run operation for backfill and catch-up.
    expectedError:
      - "Starting candle ingestor script .* in dry mode"
      - "DRY RUN: Backfill will use dummy data and limited iterations."
      - "DRY RUN: Simulating Tiingo API call for btcusd-dry.*backfill"
      - "DRY RUN: Reached max tickers for backfill"
      - "DRY RUN: Backfill simulation complete."
      - "DRY RUN: Catch-up will use dummy data and limited iterations."
      - "DRY RUN: Simulating Tiingo API call for btcusd-dry.*catch-up"
      - "DRY RUN: Reached max tickers for catch-up"
      - "Catch-up candle processing completed."
      - "Candle ingestor script completed successfully."
