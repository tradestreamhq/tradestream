kafka:
  replicaCount: 3
  image:
    repository: bitnami/kafka@sha256
    tag: fa8682647a5ab2a57fc76b88a47d22fe7992a8275281d9b812813079236e39f6  # Known to have ARM support
    pullPolicy: Always  # Ensures that the image is pulled each time a pod is created

  config:
    # KRaft-specific configuration
    processRoles: broker,controller
    # The node ID will be set dynamically in the StatefulSet
    controllerQuorumVoters: |
      0@kafka-0.kafka-headless.tradestream-namespace.svc.cluster.local:9093,\
      1@kafka-1.kafka-headless.tradestream-namespace.svc.cluster.local:9093,\
      2@kafka-2.kafka-headless.tradestream-namespace.svc.cluster.local:9093
    listeners: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093
    listenerSecurityProtocolMap: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
    interBrokerListenerName: PLAINTEXT
    controllerListenerNames: CONTROLLER
    logDirs: /var/lib/kafka/data
    offsetStorage: kafka
    transactionStateLogReplicationFactor: 3
    transactionStateLogMinIsr: 2

  resources:
    requests:
      memory: 2048Mi
      cpu: 1000m
