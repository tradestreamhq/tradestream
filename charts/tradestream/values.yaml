influxdb:
  enabled: true
  # Authentication configuration
  adminUser:
    # Organization and bucket settings
    organization: "tradestream-org"
    bucket: "tradestream-data"
    retention_policy: "30d"
    # User credentials
    user: "admin"
    # Use existing secret (this will ignore password and token values)
    existingSecret: "influxdb-admin-secret"
  # Storage configuration
  persistence:
    enabled: true
    size: 20Gi
  # Add resource limits and requests for stability
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2"
      memory: "4Gi"
  # Fix service port configuration
  service:
    type: ClusterIP
    port: 8086
    targetPort: 8086
  # Add readiness probe
  readinessProbe:
    httpGet:
      path: /ping
      port: 8086
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 3
kafka:
  replicaCount: 3
  persistence:
    enabled: true
    size: 10Gi
    accessModes:
      - ReadWriteOnce
  listeners:
    client:
      protocol: PLAINTEXT
    controller:
      protocol: PLAINTEXT
  configurationOverrides:
    "controller.quorum.voters": "0@kafka-0.kafka-headless:9093,1@kafka-1.kafka-headless:9093,2@kafka-2.kafka-headless:9093"
  podSecurityContext:
    runAsUser: 1001
    fsGroup: 1001
  resources:
    requests:
      cpu: "1"
      memory: "2Gi"
    limits:
      cpu: "2"
      memory: "4Gi"
kafkaUi:
  replicaCount: 1
  image:
    repository: provectuslabs/kafka-ui
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
pipeline:
  runMode: wet
  image:
    repository: tradestreamhq/tradestream-data-pipeline
    tag: v1.32.35-develop
    pullPolicy: IfNotPresent
  version: v1_18
  configuration:
    env.java.opts.jobmanager: "-Dio.jenetics.util.defaultRandomGenerator=Random"
    env.java.opts.taskmanager: "-Dio.jenetics.util.defaultRandomGenerator=Random"
    taskmanager.numberOfTaskSlots: "1"
    execution.checkpointing.interval: "300000"
    execution.checkpointing.mode: "EXACTLY_ONCE"
    execution.checkpointing.timeout: "1800000"
    execution.checkpointing.externalized-checkpoint-retention: "RETAIN_ON_CANCELLATION"
    state.backend: "rocksdb"
    state.backend.incremental: "true"
  serviceAccount: flink
  jobManager:
    memory: 4096m
    cpu: 2
  taskManager:
    memory: 4096m
    cpu: 2
  job:
    entryClass: com.verlumen.tradestream.pipeline.App
    jarURI: local:///src/main/java/com/verlumen/tradestream/pipeline/app_deploy.jar
    parallelism: 1
    upgradeMode: stateless
candleIngestor:
  enabled: true
  replicaCount: 1
  image:
    repository: "tradestreamhq/candle-ingestor"
    pullPolicy: IfNotPresent
    tag: "v1.32.35-develop"
  config:
    topNCryptos: 10
    candleGranularityMinutes: 1
    influxDbBucket: "tradestream-data"
    dataSources: "coinmarketcap,tiingo"
  secrets:
    cmcApiKey:
      name: "coinmarketcap"
      key: "apiKey"
    tiingoApiKey:
      name: "tiingo"
      key: "apiKey"
    influxDb:
      name: "influxdb-admin-secret"
      tokenKey: "admin-token"
